<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>书源编辑器</title>
  <style>
    body { font-family: system-ui; max-width: 900px; margin: 20px auto; }
    h2 { margin-top: 24px; }
    label { display: block; margin-top: 12px; }
    input, textarea, select { width: 100%; padding: 6px; }
    textarea { min-height: 60px; }
    button { margin-top: 12px; }
    pre { background: #f6f6f6; padding: 10px; overflow: auto; }
  </style>
</head>
<body>

<h1>书源编辑器（解析规则）</h1>

<label>
  书源名称
  <input id="name" placeholder="manwa.me" />
</label>

<h2>搜索规则（对应 /search 页面）</h2>

<label>
  搜索结果列表规则（每一本书）
  <input id="search_list" placeholder=".book-list .book-item" />
</label>

<label>
  书名规则（相对于列表项）
  <input id="search_name" placeholder=".title" />
</label>

<label>
  作者规则（可选）
  <input id="search_author" placeholder=".author" />
</label>

<label>
  书籍链接规则
  <input id="search_bookUrl" placeholder="a" />
</label>

<button onclick="save()">保存书源</button>
<button onclick="exportJson()">导出 JSON</button>

<h2>当前书源 JSON</h2>
<pre id="output"></pre>

<script>
const KEY = 'book_sources';

function getSources() {
  return JSON.parse(localStorage.getItem(KEY) || '[]');
}

function saveSources(list) {
  localStorage.setItem(KEY, JSON.stringify(list, null, 2));
}

function buildSource() {
  return {
    name: name.value.trim(),
    search: {
      list: search_list.value.trim(),
      name: search_name.value.trim(),
      author: search_author.value.trim(),
      bookUrl: search_bookUrl.value.trim()
    }
  };
}

function save() {
  const src = buildSource();
  if (!src.name || !src.search.list || !src.search.name) {
    alert('书源名称、列表规则、书名规则是必填的');
    return;
  }

  const list = getSources();
  const idx = list.findIndex(s => s.name === src.name);
  if (idx >= 0) list[idx] = src;
  else list.push(src);

  saveSources(list);
  render(src);
  alert('已保存');
}

function exportJson() {
  const data = JSON.stringify(getSources(), null, 2);
  navigator.clipboard.writeText(data);
  alert('已复制到剪贴板');
}

function render(src) {
  output.textContent = JSON.stringify(src, null, 2);
}
</script>
</body>
</html>

